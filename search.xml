<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Angular Live Reload 在 Ubuntu 沒反應</title>
    <url>/2020/08/31/AngularLiveReload/</url>
    <content><![CDATA[<h1 id="確認-inotify-設定"><a class="header-anchor" href="#確認-inotify-設定"></a>確認 inotify 設定</h1>
<p>在 Linux 上，默認情況下，Listen 使用 inotify 監視目錄中的更改</p>
<p>Ubuntu 的 inotify 預設限制為8192</p>
<p>您可以通過執行以下操作獲取目前的 inotify 文件監視限制：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/fs/inotify/max_user_watches</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="調整-inotify-設定"><a class="header-anchor" href="#調整-inotify-設定"></a>調整 inotify 設定</h1>
<p>如果此限制不足以監視目錄中的所有文件，則必須增加該限制以使其正常工作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo sysctl fs.inotify.max_user_watches=524288 </span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>
<p>如果想讓自己的限制永久化，請輸入以下命令:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> fs.inotify.max_user_watches=524288 | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://askubuntu.com/questions/770374/user-limit-of-inotify-watches-reached-on-ubuntu-16-04">User limit of inotify watches reached on Ubuntu 16.04</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Angular</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在 pi 3b+ 上執行 Angular Protractor</title>
    <url>/2019/12/25/AngularProtractorOnPi/</url>
    <content><![CDATA[<h1 id="安裝-WebDriver"><a class="header-anchor" href="#安裝-WebDriver"></a>安裝 WebDriver</h1>
<p>首先依照硬體架構從<a href="https://launchpad.net/ubuntu/trusty/+package/chromium-chromedriver">launchpad.net</a></p>
<p>下載 Chromium 瀏覽器專用的 WebDriver</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://launchpadlibrarian.net/361669488/chromium-chromedriver_65.0.3325.181-0ubuntu0.14.04.1_armhf.deb</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>接下來進行安裝</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i chromium-chromedriver_65.0.3325.181-0ubuntu0.14.04.1_armhf.deb</span><br></pre></td></tr></table></figure>
<p>預設會放置在</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/lib/chromium-browser/chromedriver</span><br></pre></td></tr></table></figure>
<h1 id="設定-protractor"><a class="header-anchor" href="#設定-protractor"></a>設定 protractor</h1>
<p>接下來更改 protractor.conf.js 的設定，加入下方設定</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chromeDriver: &#x27;/usr/lib/chromium-browser/chromedriver&#x27;</span><br></pre></td></tr></table></figure>
<p>運行 Protractor 時使用 --no-webdriver-update 選項</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ng e2e --no-webdriver-update</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://blog.gtwang.org/iot/raspberry-pi/raspberry-pi-install-chromium-chrome-driver/">樹莓派 Raspberry Pi 使用 Python + Selenium 控制 Chromium 瀏覽器</a></li>
<li><a href="https://github.com/angular/protractor/blob/master/lib/config.ts">Protractor config 設定參考</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Angular</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Angular</tag>
        <tag>Pi</tag>
        <tag>Protractor</tag>
      </tags>
  </entry>
  <entry>
    <title>如何設定 Protractor WebDriver Version</title>
    <url>/2020/08/31/AngularProtractorWebDriver/</url>
    <content><![CDATA[<h1 id="安裝-WebDriver"><a class="header-anchor" href="#安裝-WebDriver"></a>安裝 WebDriver</h1>
<p>先清除目前下載的 WebDriver</p>
<span id="more"></span>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx  webdriver-manager clean</span><br></pre></td></tr></table></figure>
<p>以 chrome 為例從<a href="http://chromedriver.chromium.org/">chromedriver網頁</a></p>
<p>查詢所需的版本號</p>
<p>接下來依版本下載 WebDriver</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx webdriver-manager update  --versions.chrome  [chrome版本號]</span><br></pre></td></tr></table></figure>
<h1 id="運行-Protractor"><a class="header-anchor" href="#運行-Protractor"></a>運行 Protractor</h1>
<p>運行 Protractor 時使用 --no-webdriver-update 選項</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ng e2e --no-webdriver-update</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://www.npmjs.com/package/webdriver-manager">webdriver-manager NPM</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Angular</category>
      </categories>
      <tags>
        <tag>Angular</tag>
        <tag>Protractor</tag>
      </tags>
  </entry>
  <entry>
    <title>FontForge 使用 Python Script 進行字型檔轉換</title>
    <url>/2021/10/23/FontForgePythonTransfer/</url>
    <content><![CDATA[<h1 id="建立-font-py-檔案"><a class="header-anchor" href="#建立-font-py-檔案"></a>建立 <a href="http://font.py">font.py</a> 檔案</h1>
<p>使用 python 操作 fontforge 轉換字型檔</p>
<span id="more"></span>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 載入 FontForge 模組</span></span><br><span class="line"><span class="keyword">import</span> fontforge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定義 main 函數</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():	</span><br><span class="line">	<span class="comment"># 載入參數</span></span><br><span class="line">	fontFilePath = sys.argv[<span class="number">1</span>]	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 開啟字型檔</span></span><br><span class="line">	originFile=fontforge.<span class="built_in">open</span>(fontFilePath)	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 選取 unicode 特定範圍的字型</span></span><br><span class="line">	originFile.selection.select((<span class="string">&quot;ranges&quot;</span>, <span class="string">&quot;unicode&quot;</span>), <span class="number">0xe000</span>, <span class="number">0xf8ff</span>)	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 複製字型至剪貼簿</span></span><br><span class="line">	originFile.copy()	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 建立新的字型檔</span></span><br><span class="line">	newFile=fontforge.font()</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 設定 sfnt_names 參數與原檔一致</span></span><br><span class="line">	newFile.sfnt_names = originFile.sfnt_names	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 設定 encoding 參數與原檔一致</span></span><br><span class="line">	newFile.encoding = originFile.encoding	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 設定 size 參數與原檔一致</span></span><br><span class="line">	newFile.em = originFile.em	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 設定 layers 參數與原檔一致</span></span><br><span class="line">	newFile.layers[<span class="string">&#x27;Fore&#x27;</span>].is_quadratic = originFile.layers[<span class="string">&#x27;Fore&#x27;</span>].is_quadratic	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 選取 unicode 特定範圍的字型</span></span><br><span class="line">	newFile.selection.select((<span class="string">&quot;ranges&quot;</span>, <span class="string">&quot;unicode&quot;</span>), <span class="number">0xe000</span>, <span class="number">0xf8ff</span>)	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 貼上剪貼簿內容</span></span><br><span class="line">	newFile.paste()	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 設定字型名稱</span></span><br><span class="line">	newFile.fontname=<span class="string">&quot;EUDC&quot;</span>	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 保存為woff字型</span></span><br><span class="line">	newFile.generate(<span class="string">&quot;EUDC.woff&quot;</span>)	</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 關閉字型檔</span></span><br><span class="line">	originFile.close()	</span><br><span class="line"></span><br><span class="line"><span class="comment"># 執行 main 函數</span></span><br><span class="line">main()	</span><br></pre></td></tr></table></figure>
<h1 id="執行-Python-Script"><a class="header-anchor" href="#執行-Python-Script"></a>執行 Python Script</h1>
<p>使用 FontForge 執行 Python Script</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fontforge -script font.py [FontFilePath]</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://fontforge.org/docs/scripting/python.html">Python Scripting</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>FontForge</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Font</tag>
        <tag>Woff</tag>
      </tags>
  </entry>
  <entry>
    <title>Json 格式資料如何拆解成 form 的輸入項</title>
    <url>/2020/03/27/HtmlFormPost/</url>
    <content><![CDATA[<h1 id="拆解-Json-格式資料"><a class="header-anchor" href="#拆解-Json-格式資料"></a>拆解 Json 格式資料</h1>
<p>下方是 Json 格式資料</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="string">&quot;2&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="基本物件型別拆解"><a class="header-anchor" href="#基本物件型別拆解"></a>基本物件型別拆解</h1>
<p>基本物件型別的拆解如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&quot;item&quot;: &quot;1&quot;</span><br><span class="line">可拆解成:</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;item&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="陣列型別拆解"><a class="header-anchor" href="#陣列型別拆解"></a>陣列型別拆解</h1>
<p>陣列部分需依造陣列結構做拆解</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&quot;items&quot;: [&quot;1&quot;,&quot;2&quot;]</span><br><span class="line">可拆解成:</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;items[0]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;items[1]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="完整拆解設定"><a class="header-anchor" href="#完整拆解設定"></a>完整拆解設定</h1>
<p>最後是完整的 HTML form 設定</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/api/Test/Post&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;item&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;items[0]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;items[1]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;送出表單&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://stackoverflow.com/questions/9073690/post-an-array-from-an-html-form-without-javascript">POST an array from an HTML form without javascript</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Html</category>
      </categories>
      <tags>
        <tag>Html</tag>
        <tag>Json</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins 執行備份專案命令</title>
    <url>/2024/01/01/JenkinsBackupProject/</url>
    <content><![CDATA[<h1 id="設定執行時間"><a class="header-anchor" href="#設定執行時間"></a>設定執行時間</h1>
<p>在 Pipeline 取得執行時間</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">dateNow = <span class="keyword">new</span> Date().format( <span class="string">&#x27;yyyyMMddHHmmss&#x27;</span> )</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="設定專案目錄與備份目錄"><a class="header-anchor" href="#設定專案目錄與備份目錄"></a>設定專案目錄與備份目錄</h1>
<p>在 Pipeline 定義專案目錄與備份目錄</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">projectPath = <span class="string">&quot;[專案目錄]&quot;</span></span><br><span class="line">backupPath = <span class="string">&quot;[備份目錄]&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="移除三個月以上的備份資料"><a class="header-anchor" href="#移除三個月以上的備份資料"></a>移除三個月以上的備份資料</h1>
<p>使用 ssh 命令登入 Server 移除三個月以上的備份資料</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">sh <span class="string">&quot;ssh -p [ssh連接Port] [帳號]@[Server位置] \&quot;find $&#123;backupPath&#125;* -maxdepth 0 -type d -ctime +90 2&gt;/dev/null | sudo xargs -r rm -rf \&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="依執行時間建立備份目錄"><a class="header-anchor" href="#依執行時間建立備份目錄"></a>依執行時間建立備份目錄</h1>
<p>使用 ssh 命令登入 Server 依執行時間建立備份目錄</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">sh <span class="string">&quot;ssh -p [ssh連接Port] [帳號]@[Server位置] \&quot;sudo mkdir -p $&#123;backupPath&#125;$&#123;dateNow&#125; \&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="專案複製至備份目錄"><a class="header-anchor" href="#專案複製至備份目錄"></a>專案複製至備份目錄</h1>
<p>使用 ssh 命令登入 Server 將專案複製至備份目錄</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">sh <span class="string">&quot;ssh -p [ssh連接Port] [帳號]@[Server位置] \&quot;sudo cp -r $&#123;projectPath&#125;* $&#123;backupPath&#125;$&#123;dateNow&#125;/ \&quot;&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Jenkins</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 Linux 檔案列表建立 Jenkins 下拉選單</title>
    <url>/2021/10/23/JenkinsDropdown/</url>
    <content><![CDATA[<h1 id="取得檔案列表方法"><a class="header-anchor" href="#取得檔案列表方法"></a>取得檔案列表方法</h1>
<p>使用以下 Linxu 指令，將預設目錄每個檔案使用一列的方式逐一列出</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -1 /home/ubuntu</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>在 Pipeline 執行 Linxu 指令，把結果存入變數</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> fileInFolder = sh(<span class="attr">script:</span> <span class="string">&quot;ls -1 /home/ubuntu&quot;</span>, <span class="attr">returnStdout:</span> <span class="literal">true</span>).trim();</span><br></pre></td></tr></table></figure>
<h1 id="定義-Dialog"><a class="header-anchor" href="#定義-Dialog"></a>定義 Dialog</h1>
<p>在 Pipeline 定義 Dialog ，把 parameters -&gt; choice -&gt; choices 定義替換為上方變數 fileInFolder</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> dialogMessage = <span class="string">&quot;Release $&#123;JOB_NAME&#125; now?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> confirmDialog =</span><br><span class="line">    input <span class="attr">message:</span> dialogMessage,</span><br><span class="line">    <span class="symbol">parameters:</span> [choice(<span class="attr">name:</span> <span class="string">&#x27;action&#x27;</span>, <span class="attr">choices:</span> fileInFolder, <span class="attr">description:</span> <span class="string">&#x27;&#x27;</span>)],</span><br><span class="line">    <span class="symbol">submitterParameter:</span> <span class="string">&#x27;releaseApprover&#x27;</span></span><br></pre></td></tr></table></figure>
<p>取得用戶選取參數，使用變數 confirmDialog -&gt; parameters -&gt; choice -&gt; name的定義</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">confirmDialog.action</span><br></pre></td></tr></table></figure>
<p>取得點擊確認的用戶，使用變數 confirmDialog -&gt; submitterParameter的定義</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">confirmDialog.releaseApprover</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Jenkins</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>如何將 Base64 編碼轉成檔案</title>
    <url>/2019/12/09/JsBase64ToFile/</url>
    <content><![CDATA[<h1 id="Chrome-base64-轉換成檔案"><a class="header-anchor" href="#Chrome-base64-轉換成檔案"></a>Chrome base64 轉換成檔案</h1>
<p>下方是使用 JavaScript 把 base64 轉換成檔案的方法</p>
<span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">function</span> <span class="title function_">downloadFile</span>(<span class="params">base64Str</span>) &#123;</span><br><span class="line">    <span class="comment">// 解碼 base64</span></span><br><span class="line">    <span class="keyword">const</span> byteCharacters = <span class="title function_">atob</span>(base64Str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立 Byte Array</span></span><br><span class="line">    <span class="keyword">const</span> byteNumbers = <span class="keyword">new</span> <span class="title class_">Array</span>(byteCharacters.<span class="property">length</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteCharacters.<span class="property">length</span>; i++) &#123;</span><br><span class="line"> </span><br><span class="line">       byteNumbers[i] = byteCharacters.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> byteArray = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(byteNumbers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立二進制檔和聲明 MIME Type</span></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([byteArray], &#123;<span class="attr">type</span>: <span class="string">&#x27;image/jpg&#x27;</span>&#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 下載檔案</span></span><br><span class="line">    <span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 建立檔案物件連結</span></span><br><span class="line">    <span class="keyword">const</span> blobUrl = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line"> </span><br><span class="line">    link.<span class="property">href</span> = blobUrl;</span><br><span class="line"> </span><br><span class="line">    link.<span class="property">download</span> = <span class="string">&#x27;file.jpg&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    link.<span class="title function_">click</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(blobUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="IE-10-base64-轉換成檔案"><a class="header-anchor" href="#IE-10-base64-轉換成檔案"></a>IE 10 base64 轉換成檔案</h1>
<p>如果瀏覽器使用 IE 10 以上版本，可使用 window.navigator.msSaveBlob 作為替代方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">downloadFile</span>(<span class="params">base64Str</span>) &#123;</span><br><span class="line">   <span class="comment">// 解碼 base64</span></span><br><span class="line">   <span class="keyword">const</span> byteCharacters = <span class="title function_">atob</span>(base64Str);</span><br><span class="line">	</span><br><span class="line">   <span class="comment">// 建立 Byte Array</span></span><br><span class="line">   <span class="keyword">const</span> byteNumbers = <span class="keyword">new</span> <span class="title class_">Array</span>(byteCharacters.<span class="property">length</span>);</span><br><span class="line">	</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteCharacters.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      byteNumbers[i] = byteCharacters.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">const</span> byteArray = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(byteNumbers);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 建立二進制檔和聲明 MIME Type</span></span><br><span class="line">   <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([byteArray], &#123;<span class="attr">type</span>: <span class="string">&#x27;image/jpg&#x27;</span>&#125;);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 下載檔案</span></span><br><span class="line">   <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="title function_">msSaveBlob</span>(blob, <span class="string">&#x27;file.jpg&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/atob">MDN atob</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Base64</tag>
      </tags>
  </entry>
  <entry>
    <title>如何將檔案轉成 Base64 編碼</title>
    <url>/2019/12/09/JsFileToBase64/</url>
    <content><![CDATA[<h1 id="建立-HTML"><a class="header-anchor" href="#建立-HTML"></a>建立 HTML</h1>
<p>首先在 HTML 建立一個 File Upload 與一個顯示結果的 div</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="綁定事件"><a class="header-anchor" href="#綁定事件"></a>綁定事件</h1>
<p>接下來為 File Upload 綁定事件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 建立 FileReader 去讀取 File Upload 的內容</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 設定初始化事件</span></span><br><span class="line"></span><br><span class="line">       reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">let</span> arrayBuffer = <span class="variable language_">this</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">let</span> base64 = <span class="title function_">btoa</span>(</span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(arrayBuffer)</span><br><span class="line">                   .<span class="title function_">reduce</span>(<span class="function">(<span class="params">data, byte</span>) =&gt;</span> data + <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(byte), <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">           );</span><br><span class="line">       </span><br><span class="line">         <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#result&#x27;</span>).<span class="property">innerHTML</span> = arrayBuffer + <span class="string">&#x27;  &#x27;</span> + arrayBuffer.<span class="property">byteLength</span>;    </span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 開始讀取</span></span><br><span class="line"></span><br><span class="line">      reader.<span class="title function_">readAsArrayBuffer</span>(<span class="variable language_">this</span>.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">   &#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa">MDN btoa</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Base64</tag>
      </tags>
  </entry>
  <entry>
    <title>如何判斷 Function 是否存在</title>
    <url>/2019/12/28/JsFunction/</url>
    <content><![CDATA[<h1 id="建立-function"><a class="header-anchor" href="#建立-function"></a>建立 function</h1>
<p>建立一個名稱為 TEST 的 function</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TEST</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;call function TEST&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="判斷-function-是否存在"><a class="header-anchor" href="#判斷-function-是否存在"></a>判斷 function 是否存在</h1>
<p>判斷 function 是否存在 Window 變數中，並執行</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> funcName = <span class="string">&#x27;TEST&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="variable language_">window</span>[<span class="title class_">FuncName</span>]) == <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 執行方法</span></span><br><span class="line">        <span class="variable language_">window</span>[<span class="title class_">FuncName</span>]();</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;此方法不存在&#x27;</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof">MDN typeof</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Function</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在 Iframe 讀取或寫入字串</title>
    <url>/2019/12/28/JsIframe/</url>
    <content><![CDATA[<h1 id="建立-HTML"><a class="header-anchor" href="#建立-HTML"></a>建立 HTML</h1>
<p>首先在 HTML 建立一個 iframe</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="操作-iframe"><a class="header-anchor" href="#操作-iframe"></a>操作 iframe</h1>
<p>用 Javascript 搜尋 iframe 的DOM物件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>).<span class="property">contentDocument</span>;</span><br></pre></td></tr></table></figure>
<p>字串寫入 iframe</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">iframe.<span class="title function_">open</span>();</span><br><span class="line"></span><br><span class="line">iframe.<span class="title function_">write</span>(<span class="string">&#x27;&lt;a&gt;test&lt;/a&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">iframe.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>
<p>取得 iframe 字串</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">iframe.<span class="property">body</span>.<span class="property">innerText</span></span><br></pre></td></tr></table></figure>
<p>URL.createObjectURL 寫入 iframe</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> blobx = <span class="keyword">new</span> <span class="title class_">Blob</span>(</span><br><span class="line">    [<span class="string">&#x27;&lt;base href=&quot;[URL輸入]&quot;&gt;&#x27;</span> + data],</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> urlObject = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blobx)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;src&#x27;</span>, urlObject)</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/write">MDN Document write</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Iframe</tag>
      </tags>
  </entry>
  <entry>
    <title>如何迭代 Js 物件</title>
    <url>/2020/03/27/JsIteratorObject/</url>
    <content><![CDATA[<h1 id="使用-for…in"><a class="header-anchor" href="#使用-for…in"></a>使用 for…in</h1>
<p>方法格式如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (變數 <span class="keyword">in</span> 物件) &#123;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>下方為 Sample Code</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> model = &#123;</span><br><span class="line">    <span class="attr">item</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> filed <span class="keyword">in</span> model) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(model[filed]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用-Object-keys"><a class="header-anchor" href="#使用-Object-keys"></a>使用 Object.keys()</h1>
<p>方法格式如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(物件);</span><br></pre></td></tr></table></figure>
<p>下方為 Sample Code</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> model = &#123;</span><br><span class="line">    <span class="attr">item</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(model);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> length = keys.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> key =  keys[i];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(model[key]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="差異"><a class="header-anchor" href="#差異"></a>差異</h1>
<p>Object.keys 與 for…in 不同之處</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for-in 迴圈還會迭代出物件自其原型鏈所繼承來的可列舉屬性</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">MDN Object keys</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Object</tag>
      </tags>
  </entry>
  <entry>
    <title>如何將圖片壓縮並下載檔案</title>
    <url>/2019/12/25/JsPictureCompress/</url>
    <content><![CDATA[<h1 id="建立-HTML"><a class="header-anchor" href="#建立-HTML"></a>建立 HTML</h1>
<p>首先在 HTML 建立一個 File Upload 與一個 canvas</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span>  <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="綁定事件"><a class="header-anchor" href="#綁定事件"></a>綁定事件</h1>
<p>接下來為 File Upload 綁定事件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 取得第一個檔案</span></span><br><span class="line">    <span class="keyword">const</span> file= <span class="variable language_">this</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取得 canvas</span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);   </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 宣告 Image 物件</span></span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立 Image 載入事件</span></span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在 canvas 載入圖片 </span></span><br><span class="line">        canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>).<span class="title function_">drawImage</span>(img,<span class="number">0</span>,<span class="number">0</span>,<span class="number">800</span>,<span class="number">600</span>); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 回收圖片物件</span></span><br><span class="line">        <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(img.<span class="property">src</span>);   </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 把 canvas 圖片轉成 Blob 格式</span></span><br><span class="line">        canvas.<span class="title function_">toBlob</span>(<span class="function">(<span class="params">blob</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 宣告FileReader物件</span></span><br><span class="line">            <span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 建立 FileReader 載入完成事件</span></span><br><span class="line">            reader.<span class="property">onloadend</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(reader.<span class="property">result</span>.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 讀取 Blob 格式物件</span></span><br><span class="line">            reader.<span class="title function_">readAsDataURL</span>(blob);</span><br><span class="line">        &#125;, <span class="string">&quot;image/jpeg&quot;</span>, <span class="number">0.8</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 圖片物件載入檔案</span></span><br><span class="line">    img.<span class="property">src</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(file);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">MDN Canvas_API</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>如何使用 Regex 群組</title>
    <url>/2022/05/22/JsRegexGroup/</url>
    <content><![CDATA[<h1 id="使用-Regex-群組"><a class="header-anchor" href="#使用-Regex-群組"></a>使用 Regex 群組</h1>
<p>群組方法用法如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 建立規則</span></span><br><span class="line"><span class="keyword">var</span> myRegexp = <span class="regexp">/(?&lt;群組名稱&gt;.*)Test/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 執行規則</span></span><br><span class="line"><span class="keyword">var</span> match =  myRegexp.<span class="title function_">exec</span>(<span class="string">&#x27;123Test&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得執行結果 output: 123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match.<span class="property">groups</span>.群組名稱);</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Groups_and_Ranges">MDN</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
        <tag>Regex</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux IBM i Access Odbc 手動安裝</title>
    <url>/2021/10/05/LinuxIbmIAccessOdbc/</url>
    <content><![CDATA[<h1 id="配置-Odbc-元件"><a class="header-anchor" href="#配置-Odbc-元件"></a>配置 Odbc 元件</h1>
<p>安裝 Linux Odbc 元件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install unixodbc</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="安裝-Odbc-Driver"><a class="header-anchor" href="#安裝-Odbc-Driver"></a>安裝 Odbc Driver</h1>
<p>登入<a href="https://www.ibm.com/support/pages/ibm-i-access-client-solutions">IBM網頁</a>下載Linux Odbc Driver並安裝</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i ibm-iaccess-1.1.0.15-1.0.amd64.deb</span><br></pre></td></tr></table></figure>
<p>查看 Linux Odbc Drivers 設定檔位置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">odbcinst -j</span><br></pre></td></tr></table></figure>
<p>查看設定檔是否出現 IBM i Access ODBC Driver 的設定</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/odbcinst.ini</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://www.ibm.com/docs/en/db2/11.5?topic=managers-installing-unixodbc-driver-manager">Installing the unixODBC driver manager</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Odbc</tag>
        <tag>IBM i Access</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Mssql Odbc 手動安裝</title>
    <url>/2021/10/05/LinuxMssqlOdbc/</url>
    <content><![CDATA[<h1 id="配置-Linux-Odbc-元件"><a class="header-anchor" href="#配置-Linux-Odbc-元件"></a>配置 Linux Odbc 元件</h1>
<p>安裝 Linux Odbc 元件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install unixodbc</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="安裝-Odbc-Driver"><a class="header-anchor" href="#安裝-Odbc-Driver"></a>安裝 Odbc Driver</h1>
<p>登入<a href="https://docs.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver15">Microsoft網頁</a>下載Odbc Driver並安裝</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i msodbcsql17_17.8.1.1-1_amd64.deb</span><br></pre></td></tr></table></figure>
<p>查看 Linux Odbc Drivers 設定檔位置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">odbcinst -j</span><br></pre></td></tr></table></figure>
<p>查看設定檔是否出現 ODBC Driver 17 for SQL Server 的設定</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/odbcinst.ini</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://www.ibm.com/docs/en/db2/11.5?topic=managers-installing-unixodbc-driver-manager">Installing the unixODBC driver manager</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Odbc</tag>
        <tag>Mssql</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 SSH 建立通道</title>
    <url>/2023/05/07/LinuxSshTunnel/</url>
    <content><![CDATA[<h1 id="本機特定端口轉發至跳板機"><a class="header-anchor" href="#本機特定端口轉發至跳板機"></a>本機特定端口轉發至跳板機</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -p [跳板機端口] -C -f -N -g -L [本地端口]:[遠端服務IP]:[遠端服務端口] [帳號]@[跳板機IP]</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="跳板機轉發至本機特定端口"><a class="header-anchor" href="#跳板機轉發至本機特定端口"></a>跳板機轉發至本機特定端口</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -p [跳板機端口] -C -g -R 0.0.0.0:[跳板機端口]:localhost:[本地端口] [帳號]@[跳板機IP]</span><br></pre></td></tr></table></figure>
<h1 id="請求轉發至跳板，可搭配-Whistle-做-Socks-代理"><a class="header-anchor" href="#請求轉發至跳板，可搭配-Whistle-做-Socks-代理"></a>請求轉發至跳板，可搭配 Whistle 做 Socks 代理</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -p [跳板機端口] -D localhost:[本地端口] [帳號]@[跳板機IP]</span><br></pre></td></tr></table></figure>
<h1 id="ssh-執行選項說明"><a class="header-anchor" href="#ssh-執行選項說明"></a>ssh 執行選項說明</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-L: 指定將本機上的特定端口轉發到遠端主機</span><br><span class="line">-R: 表示使用遠程端口轉發創建ssh隧道</span><br><span class="line">-D: port動態應用級端口轉​​發</span><br><span class="line">-p: 跳板機端口</span><br><span class="line">-C: 使用數據壓縮</span><br><span class="line">-c: cipher_spec選擇用於加密會話的密碼規範</span><br><span class="line">-f: 代表後台運行程序</span><br><span class="line">-F: configfile指定每個用戶的配置文件</span><br><span class="line">-N: 不要執行任何遠端指令</span><br><span class="line">-g: 允許遠程主機連接到本地轉發端口</span><br></pre></td></tr></table></figure>
<!-- /etc/ssh/sshd_config 加入GatewayPorts 設定，能讓所有人都連到 -->
<!-- scoop install putty
plink -v -x -a -T -C -noagent -ssh -pw "[密碼]" -P 50893 -L [本地端口]:[遠端服務IP]:[遠端服務端口] [帳號]@[跳板機IP] -->
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://www.ssh.com/academy/ssh/command">SSH Command - Usage, Options, Configuration</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 AddInMemoryCollection 設定 Configuration 進行單元測試</title>
    <url>/2023/01/21/NetAddInMemoryCollection/</url>
    <content><![CDATA[<h1 id="設定-appsettings-json-如下"><a class="header-anchor" href="#設定-appsettings-json-如下"></a>設定 appsettings.json 如下</h1>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Logging&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;LogLevel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Information&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Microsoft.AspNetCore&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Warning&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="轉換為-Dictionary-string-string"><a class="header-anchor" href="#轉換為-Dictionary-string-string"></a>轉換為 Dictionary&lt;string, string&gt;</h1>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; inMemorySettings = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; &#123;</span><br><span class="line">    &#123;<span class="string">&quot;Logging:LogLevel:Default&quot;</span>,  <span class="string">&quot;Information&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Logging:LogLevel:Microsoft.AspNetCore&quot;</span>,  <span class="string">&quot;Warning&quot;</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="建立-Configuration"><a class="header-anchor" href="#建立-Configuration"></a>建立 Configuration</h1>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">IConfiguration configuration = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">            .AddInMemoryCollection(inMemorySettings)</span><br><span class="line">            .Build();</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.extensions.configuration.memoryconfigurationbuilderextensions.addinmemorycollection?view=dotnet-plat-ext-7.0">MemoryConfigurationBuilderExtensions.AddInMemoryCollection Method</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>.Net</tag>
        <tag>UnitTest</tag>
        <tag>IConfiguration</tag>
      </tags>
  </entry>
  <entry>
    <title>依字元內碼轉換 Big5 與 Unicode</title>
    <url>/2022/05/22/NetBig5AndUnicode/</url>
    <content><![CDATA[<h1 id="轉換-Big5-字元"><a class="header-anchor" href="#轉換-Big5-字元"></a>轉換 Big5 字元</h1>
<p>Big5 依傳入內碼轉成字元</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 建立兩位元陣列</span></span><br><span class="line"><span class="built_in">byte</span>[] codeBytes = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 欲轉換內碼前兩字轉為16進制</span></span><br><span class="line">codeBytes[<span class="number">0</span>] = (<span class="built_in">byte</span>)Convert.ToInt32(<span class="string">&quot;欲轉換內碼&quot;</span>.Substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 欲轉換內碼後兩字轉為16進制</span></span><br><span class="line">codeBytes[<span class="number">1</span>] = (<span class="built_in">byte</span>)Convert.ToInt32(<span class="string">&quot;欲轉換內碼&quot;</span>.Substring(<span class="number">2</span>, <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轉成字元</span></span><br><span class="line">Encoding big5 = Encoding.GetEncoding(<span class="number">950</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> result = big5.GetString(bytes);</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="轉換-Unicode-字元"><a class="header-anchor" href="#轉換-Unicode-字元"></a>轉換 Unicode 字元</h1>
<p>Unicode 依傳入內碼轉成字元，與 Big5 轉換的方法雷同，只需調整內碼放置的順序</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 建立兩位元陣列</span></span><br><span class="line"><span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 欲轉換內碼後兩字轉為16進制</span></span><br><span class="line">bytes[<span class="number">0</span>] = Convert.ToByte(text.Substring(<span class="number">2</span>, <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 欲轉換內碼前兩字轉為16進制</span></span><br><span class="line">bytes[<span class="number">1</span>] = Convert.ToByte(text.Substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轉成字元</span></span><br><span class="line">Encoding unicode= Encoding.Unicode;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> result = unicode.GetString(bytes);</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.text.encoding.getstring?view=net-8.0">Encoding.GetString Method</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Font</tag>
        <tag>.Net</tag>
        <tag>Big5</tag>
        <tag>Unicode</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 lldb 分析 Dotnet 核心傾印檔案</title>
    <url>/2023/05/07/NetCoreDump/</url>
    <content><![CDATA[<h1 id="使用-apport-解壓縮核心傾印檔案"><a class="header-anchor" href="#使用-apport-解壓縮核心傾印檔案"></a>使用 apport 解壓縮核心傾印檔案</h1>
<p>安裝 apport</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install apport</span><br></pre></td></tr></table></figure>
<p>解壓縮核心傾印檔案</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apport-unpack [systemGeneratedCrashReportPath].crash [yourNewUnpackDirectoryHere]</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<!-- cd [yourNewUnpackDirectoryHere]/
sudo apt install gdb
gdb `cat ExecutablePath` CoreDump
堆疊: bt full
顯示一些特定的資訊: info
中斷點: b
印出程式碼: list ( l )
顯示正在執行的程式:info frame 0
對執行中的程式以進行除錯: attach PID
在拋出的異常上設置斷點: catch throw
印出變數內容: print *(long**)0x7fffffffdc98
檢查點: watch *(long**)0x7fffffffdc98
反向調試: reverse-stepi -->
<!-- export PATH="$PATH:/root/.dotnet/tools" -->
<!-- dotnet tool install -g dotnet-dump
dotnet-dump ps
dotnet-dump collect --process-id 1902 -->
<h1 id="安裝相關-Dotnet-工具"><a class="header-anchor" href="#安裝相關-Dotnet-工具"></a>安裝相關 Dotnet 工具</h1>
<p>安裝 dotnet-symbol 導出傾印檔案的符號</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dotnet tool install -g dotnet-symbol</span><br></pre></td></tr></table></figure>
<p>導出傾印檔案的符號</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dotnet-symbol ~/dumps/dotnet/CoreDump -o ~/dumps/symbols --host-only</span><br></pre></td></tr></table></figure>
<p>安裝 SOS 擴充偵錯工具功能</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dotnet tool install -g dotnet-sos</span><br><span class="line">dotnet-sos install</span><br></pre></td></tr></table></figure>
<h1 id="使用-lldb-偵錯"><a class="header-anchor" href="#使用-lldb-偵錯"></a>使用 lldb 偵錯</h1>
<p>安裝 lldb</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install lldb</span><br></pre></td></tr></table></figure>
<p>使用 lldb 分析核心傾印檔案</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lldb --core ~/dumps/dotnet/CoreDump</span><br></pre></td></tr></table></figure>
<p>在 lldb 中載入導入傾印檔案的符號</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">setsymbolserver -directory ~/dumps/symbols</span><br></pre></td></tr></table></figure>
<p>在 lldb 中常用命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">執行緒清單: clrthreads</span><br><span class="line">切換執行序: thread <span class="keyword">select</span> [thread]</span><br><span class="line">線程棧清單: clrstack</span><br><span class="line">所有託管堆物件: dso</span><br><span class="line">託管堆狀態: dumpheap -<span class="built_in">stat</span></span><br><span class="line">尋找託管堆的位址: dumpheap -mt [address]</span><br><span class="line">程序最近都拋了什麼異常: dumpheap -<span class="built_in">type</span> Exception</span><br><span class="line">異常狀況資訊: pe</span><br><span class="line">異常的詳細信息: pe [address]</span><br><span class="line">分析物件位置: dumpobj [address]</span><br><span class="line">分析陣列位置: dumparray [address]</span><br><span class="line">GC狀態:  eeheap -gc</span><br></pre></td></tr></table></figure>
<h1 id="安裝-ProcDump-自動擷取傾印檔案"><a class="header-anchor" href="#安裝-ProcDump-自動擷取傾印檔案"></a>安裝 ProcDump 自動擷取傾印檔案</h1>
<p>當目標進程 CPU 或記憶體使用量達到特定臨界值或低於限制值時，您可以使用 ProcDump 來擷取記憶體傾印檔案。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install procdump</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://learn.microsoft.com/zh-tw/troubleshoot/developer/webapps/aspnetcore/practice-troubleshoot-linux/lab-1-1-reproduce-troubleshoot">重現損毀問題並進行疑難排解</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/diagnostics/sos-debugging-extension">SOS debugging extension</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>.Net</tag>
        <tag>lldb</tag>
      </tags>
  </entry>
  <entry>
    <title>Http 的 Get 方法傳入 List 參數</title>
    <url>/2023/01/21/NetHttpGetWithList/</url>
    <content><![CDATA[<h1 id="建立類別"><a class="header-anchor" href="#建立類別"></a>建立類別</h1>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">User</span> &#123;</span><br><span class="line">  </span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="建立-HttpGet-方法"><a class="header-anchor" href="#建立-HttpGet-方法"></a>建立 HttpGet 方法</h1>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">HttpGet</span>]</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">Get</span>(<span class="params">[FromQuery] List&lt;User&gt; user</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="組合-Request-的-Url"><a class="header-anchor" href="#組合-Request-的-Url"></a>組合 Request 的 Url</h1>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">https://example.com/User?user[0].Name=&#x27;張三&#x27;&amp;user[0].Age=10&amp;user[1].Name=&#x27;李四&#x27;&amp;user[1].Age=20</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://stackoverflow.com/questions/3061273/send-an-array-with-an-http-get">Send an Array with an HTTP Get</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>.Net</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在資料存取層進行單元測試</title>
    <url>/2022/05/01/NetRepositoryUnitTest/</url>
    <content><![CDATA[<h1 id="安裝-Sqlite"><a class="header-anchor" href="#安裝-Sqlite"></a>安裝 Sqlite</h1>
<p>安裝 Nuget 的 Sqlite 套件</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Package</span> Microsoft.EntityFrameworkCore.Sqlite</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="建立-DbContext"><a class="header-anchor" href="#建立-DbContext"></a>建立 DbContext</h1>
<p>建立 EntityFramework 的 DbContext</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DbSet</span>&lt;<span class="title">Table</span>&gt;? Table</span> &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestDbContext</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestDbContext</span>(<span class="params">DbContextOptions options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        modelBuilder.Entity&lt;Table&gt;(entity =&gt; &#123;</span><br><span class="line">            entity.HasKey(x =&gt; x.Id);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用-In-Memory-模式操作資料庫"><a class="header-anchor" href="#使用-In-Memory-模式操作資料庫"></a>使用 In-Memory 模式操作資料庫</h1>
<p>使用 Sqlite 的 In-Memory 模式載入 DbContext</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">SqliteConnection connection = <span class="keyword">new</span> SqliteConnection(<span class="string">&quot;Data Source=:memory:&quot;</span>);</span><br><span class="line"></span><br><span class="line">connection.Open();</span><br><span class="line"></span><br><span class="line">DbContextOptions options = <span class="keyword">new</span> DbContextOptionsBuilder()</span><br><span class="line">.UseSqlite(connection)</span><br><span class="line">.Options;</span><br></pre></td></tr></table></figure>
<p>然後使用 DbContext 的設定建立資料庫</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> TestDbContext context = <span class="keyword">new</span> TestDbContext(options);</span><br><span class="line">context.Database.EnsureCreated();</span><br></pre></td></tr></table></figure>
<p>最後可開始使用 EntityFramework 開始操作資料庫</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> TestDbContext context = <span class="keyword">new</span> TestDbContext(options);</span><br><span class="line">List&lt;Table&gt; table = context.Table.ToList();</span><br></pre></td></tr></table></figure>
<h1 id="自定義-Database-Function"><a class="header-anchor" href="#自定義-Database-Function"></a>自定義 Database Function</h1>
<p>如果有使用 Sqlite 未定義的 Database Function , 可在程式中使用 CreateFunction 定義</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">SqliteConnection connection = <span class="keyword">new</span> SqliteConnection(<span class="string">&quot;Data Source=:memory:&quot;</span>);</span><br><span class="line"></span><br><span class="line">connection.CreateFunction(<span class="string">&quot;current_date&quot;</span>, (x) =&gt; DateTime.Now);</span><br><span class="line"></span><br><span class="line">connection.Open();</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.data.sqlite.sqliteconnection.createfunction?view=msdata-sqlite-6.0.0">Microsoft文件</a></li>
<li><a href="https://csharp.hotexamples.com/examples/-/SQLiteConnection/CreateFunction/php-sqliteconnection-createfunction-method-examples.html">SQLite Examples</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>.Net</tag>
        <tag>UnitTest</tag>
        <tag>SQLite</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在商業邏輯層進行單元測試</title>
    <url>/2022/05/01/NetServiceUnitTest/</url>
    <content><![CDATA[<h1 id="安裝-NSubstitute"><a class="header-anchor" href="#安裝-NSubstitute"></a>安裝 NSubstitute</h1>
<p>安裝 Nuget 的 NSubstitute 套件</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Package</span> NSubstitute</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="類別結構"><a class="header-anchor" href="#類別結構"></a>類別結構</h1>
<img  src=http://www.plantuml.com/plantuml/svg/LO_T2e9044RlvoackYd8G2z55YiXWgwi5nYt8HTqNTOnwErRfH-x_iuvyEMza9UXRM0XDRUClIFD3LK0BWn66qTMyCB-OJHZbk7gi5dkYYBU9sii1tlkxaQZKlzyoQxhZNJ-EIcddt9aAKXeCZxLIAcPaMAy7SjV562MYqRuBQQO199by1QlL3MC8m-Gixs5Ioy0>
<h1 id="建立模擬物件"><a class="header-anchor" href="#建立模擬物件"></a>建立模擬物件</h1>
<p>建立 Repository 的模擬物件</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">Repository mockRepository = Substitute.For&lt;Repository&gt;();</span><br><span class="line"></span><br><span class="line">mockRepository</span><br><span class="line">.GetData(Arg.Any&lt;<span class="built_in">string</span>&gt;())</span><br><span class="line">.Returns(<span class="keyword">new</span> Table &#123;</span><br><span class="line">    Id = <span class="number">1</span>,</span><br><span class="line">    Name = <span class="string">&quot;張三&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="注入模擬物件"><a class="header-anchor" href="#注入模擬物件"></a>注入模擬物件</h1>
<p>把 Repository 的模擬物件注入 Service</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">Service service = <span class="keyword">new</span> Service(mockRepository);</span><br></pre></td></tr></table></figure>
<p>使用 Service</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">Table result = service.RunLogic();</span><br><span class="line"></span><br><span class="line">Assert.That(result.Name, Is.EqualTo(<span class="string">&quot;張三&quot;</span>));</span><br></pre></td></tr></table></figure>
<h1 id="驗證模擬物件"><a class="header-anchor" href="#驗證模擬物件"></a>驗證模擬物件</h1>
<p>依傳入參數做回傳</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">mockRepository</span><br><span class="line">.GetData(<span class="string">&quot;張三&quot;</span>)</span><br><span class="line">.Returns(<span class="keyword">new</span> Table &#123;</span><br><span class="line">    Id = <span class="number">1</span>,</span><br><span class="line">    Name = <span class="string">&quot;張三&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mockRepository</span><br><span class="line">.GetData(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">.Returns(<span class="keyword">new</span> Table &#123;</span><br><span class="line">    Id = <span class="number">2</span>,</span><br><span class="line">    Name = <span class="string">&quot;李四&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>模擬呼叫方法多次依序回傳不同內容</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">mockRepository</span><br><span class="line">.GetData(Arg.Any&lt;<span class="built_in">string</span>&gt;())</span><br><span class="line">.Returns(</span><br><span class="line">    <span class="keyword">new</span> Table</span><br><span class="line">    &#123;</span><br><span class="line">        Id = <span class="number">1</span>,</span><br><span class="line">        Name = <span class="string">&quot;張三&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">new</span> Table</span><br><span class="line">    &#123;</span><br><span class="line">        Id = <span class="number">2</span>,</span><br><span class="line">        Name = <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>驗證呼叫方法的次數與傳入參數</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">mockRepository</span><br><span class="line">.Received(<span class="number">1</span>)</span><br><span class="line">.GetData(Arg.Is&lt;<span class="built_in">string</span>&gt;(x =&gt; x == <span class="string">&quot;張三&quot;</span>));</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://nsubstitute.github.io/help.html">NSubstitute文件</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>.Net</tag>
        <tag>UnitTest</tag>
        <tag>NSubstitute</tag>
      </tags>
  </entry>
  <entry>
    <title>如何解析 XML 資料</title>
    <url>/2024/02/04/NetXmlParse/</url>
    <content><![CDATA[<h1 id="宣告-XML-資料"><a class="header-anchor" href="#宣告-XML-資料"></a>宣告 XML 資料</h1>
<p>XML 格式字串如下</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> doc = <span class="string">@&quot;&lt;properties&gt;</span></span><br><span class="line"><span class="string">&lt;property key=&#x27;name&#x27;&gt;Test&lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;property key=&#x27;age&#x27;&gt;10&lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/properties&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<h1 id="使用-XDocument-解析-XML"><a class="header-anchor" href="#使用-XDocument-解析-XML"></a>使用 XDocument 解析 XML</h1>
<h2 id="讀取資料並解析"><a class="header-anchor" href="#讀取資料並解析"></a>讀取資料並解析</h2>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// XML 字串轉 XDocument</span></span><br><span class="line">XDocument xmlDoc = XDocument.Parse(doc);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得 property 列表</span></span><br><span class="line">List&lt;XElement&gt; xmlElements = xmlDoc.Element(<span class="string">&quot;properties&quot;</span>).Elements(<span class="string">&quot;property&quot;</span>).ToList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得第一筆 key 為 name 資料</span></span><br><span class="line"><span class="built_in">string</span> name = xmlElements.Where(x =&gt; x.Attribute(<span class="string">&quot;key&quot;</span>).Value == <span class="string">&quot;name&quot;</span>).FirstOrDefault()?.Value;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="使用序列化與反序列化方法解析-XML"><a class="header-anchor" href="#使用序列化與反序列化方法解析-XML"></a>使用序列化與反序列化方法解析 XML</h1>
<h2 id="建立序列化與反序列化方法"><a class="header-anchor" href="#建立序列化與反序列化方法"></a>建立序列化與反序列化方法</h2>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 物件轉 XML 字串</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">XmlSerialize</span>&lt;<span class="title">T</span>&gt;(<span class="params">T obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	XmlSerializer xsSubmit = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(T));</span><br><span class="line"></span><br><span class="line">	XmlSerializerNamespaces ns = <span class="keyword">new</span> XmlSerializerNamespaces();</span><br><span class="line">	ns.Add(<span class="built_in">string</span>.Empty, <span class="built_in">string</span>.Empty);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">using</span> (<span class="keyword">var</span> memStm = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">	<span class="keyword">using</span> (<span class="keyword">var</span> xw = XmlWriter.Create(memStm))</span><br><span class="line">	&#123;</span><br><span class="line">		xsSubmit.Serialize(xw, obj, ns);</span><br><span class="line">		<span class="built_in">byte</span>[] utf8 = memStm.ToArray();</span><br><span class="line">		<span class="keyword">return</span> Encoding.UTF8.GetString(utf8);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// XML 字串轉物件</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">XmlDeSerialize</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> xmlString</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	XmlSerializer xsSubmit = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(T));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">byte</span>[] byteArray = Encoding.UTF8.GetBytes(xmlString);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">using</span> (<span class="keyword">var</span> memStm = <span class="keyword">new</span> MemoryStream(byteArray))</span><br><span class="line">	<span class="keyword">using</span> (<span class="keyword">var</span> xr = XmlReader.Create(memStm))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">object</span> data = xsSubmit.Deserialize(xr);</span><br><span class="line">		<span class="keyword">return</span> (T)data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="建立類別"><a class="header-anchor" href="#建立類別"></a>建立類別</h2>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">[<span class="meta">XmlRoot(ElementName = <span class="string">&quot;property&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Property</span> &#123;</span><br><span class="line"></span><br><span class="line">  [<span class="meta">XmlAttribute(AttributeName = <span class="string">&quot;key&quot;</span>)</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">string</span> Key &#123;</span><br><span class="line">    <span class="keyword">get</span>;</span><br><span class="line">    <span class="keyword">set</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="meta">XmlText</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">string</span> Text &#123;</span><br><span class="line">    <span class="keyword">get</span>;</span><br><span class="line">    <span class="keyword">set</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">XmlRoot(ElementName = <span class="string">&quot;properties&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Properties</span> &#123;</span><br><span class="line"></span><br><span class="line">  [<span class="meta">XmlElement(ElementName = <span class="string">&quot;property&quot;</span>)</span>]</span><br><span class="line">  <span class="keyword">public</span> List &lt; Property &gt; Property &#123;</span><br><span class="line">    <span class="keyword">get</span>;</span><br><span class="line">    <span class="keyword">set</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="讀取資料並解析-v2"><a class="header-anchor" href="#讀取資料並解析-v2"></a>讀取資料並解析</h2>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// XML 字串轉物件</span></span><br><span class="line">Properties data = XmlDeSerialize&lt;Properties&gt;(doc);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得第一筆 key 為 name 資料</span></span><br><span class="line"><span class="built_in">string</span> name = data.Property.Where(x =&gt; x.Key == <span class="string">&quot;name&quot;</span>).FirstOrDefault().Text;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 物件轉 XML 字串</span></span><br><span class="line"><span class="built_in">string</span> xmlFile = XmlSerialize(data);</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.linq.xdocument?view=net-8.0">XDocument Class</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer?view=net-8.0">XmlSerializer Class</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>.Net</tag>
        <tag>XML</tag>
      </tags>
  </entry>
  <entry>
    <title>自託管 PlantUML 服務</title>
    <url>/2024/02/04/PlantUmlSelfHosted/</url>
    <content><![CDATA[<h1 id="在-Ubuntu-安裝-openjdk"><a class="header-anchor" href="#在-Ubuntu-安裝-openjdk"></a>在 Ubuntu 安裝 openjdk</h1>
<p>使用以下 Linxu 指令，安裝 openjdk11</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install openjdk-11-jdk</span><br></pre></td></tr></table></figure>
<h1 id="下載-PlantUML-的-Jar-檔案"><a class="header-anchor" href="#下載-PlantUML-的-Jar-檔案"></a><a href="https://plantuml.com/zh/download">下載 PlantUML 的 Jar 檔案</a></h1>
<p>使用以下 Linxu 指令下載檔案</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O /[執行路徑]/plantuml.jar https://github.com/plantuml/plantuml/releases/download/v1.2024.0/plantuml-1.2024.0.jar</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="建立-PlantUML-服務"><a class="header-anchor" href="#建立-PlantUML-服務"></a>建立 PlantUML 服務</h1>
<p>使用以下 Linxu 指令建立 PlantUML 服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/systemd/system/plantuml.service</span><br></pre></td></tr></table></figure>
<p>服務貼上以下內容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=PlantUML</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="comment"># Deploy folder location</span></span><br><span class="line">WorkingDirectory=[執行路徑]</span><br><span class="line"><span class="comment"># Execute project by java Command</span></span><br><span class="line">ExecStart=/usr/bin/java -jar plantuml.jar -picoweb:3060:127.0.0.1</span><br><span class="line">Restart=always</span><br><span class="line"><span class="comment"># Restart service after 10 seconds if the PlantUML service crashes:</span></span><br><span class="line">RestartSec=10</span><br><span class="line">KillSignal=SIGINT</span><br><span class="line">SyslogIdentifier=PlantUML</span><br><span class="line">User=ubuntu</span><br><span class="line">MemoryMax=50%</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>啟用服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start plantuml</span><br></pre></td></tr></table></figure>
<h1 id="設定-Visual-Studio-Code"><a class="header-anchor" href="#設定-Visual-Studio-Code"></a>設定 Visual Studio Code</h1>
<p>安裝 <a href="https://marketplace.visualstudio.com/items?itemName=jebbs.plantuml">PlantUML support for Visual Studio Code</a> 套件，並在設定檔設定 plantuml.server 參數</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;plantuml.server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://[Domain]/plantuml&quot;</span></span><br></pre></td></tr></table></figure>
<p>建立 .puml 為附檔名的檔案，並加入以下代碼，按下 Alt + D 生成圖檔</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line">:Hello world;</span><br><span class="line">:This is defined on</span><br><span class="line">several **lines**;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://plantuml.com/zh/picoweb">PlantUML PicoWeb Server</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Projectm</tag>
        <tag>PlantUML</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 Flask-Caching 緩存 Flask 呼叫方法產生的資料</title>
    <url>/2023/07/07/PythonFlaskCaching/</url>
    <content><![CDATA[<h1 id="安裝套件"><a class="header-anchor" href="#安裝套件"></a>安裝套件</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install Flask-Caching</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="建立-address-json-內容如下"><a class="header-anchor" href="#建立-address-json-內容如下"></a>建立 address.json 內容如下</h1>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;新竹市&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Zip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;300&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="建立-app-py-內容如下"><a class="header-anchor" href="#建立-app-py-內容如下"></a>建立 <a href="http://app.py">app.py</a> 內容如下</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_caching <span class="keyword">import</span> Cache</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&quot;DEBUG&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&quot;CACHE_TYPE&quot;</span>: <span class="string">&quot;SimpleCache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CACHE_DEFAULT_TIMEOUT&quot;</span>: <span class="number">3000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_mapping(config)</span><br><span class="line">cache = Cache(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用裝飾器緩存呼叫方法產生的資料</span></span><br><span class="line"><span class="meta">@cache.memoize(<span class="params">timeout=<span class="number">50</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadAllAddress</span>():</span><br><span class="line">    <span class="comment"># 讀取 address.json</span></span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&#x27;address.json&#x27;</span>)</span><br><span class="line">    data = json.load(file)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除緩存</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ClearAddressCache&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delAddress</span>():</span><br><span class="line">   <span class="comment"># 刪除緩存呼叫方法產生的資料</span></span><br><span class="line">   cache.delete_memoized(LoadAllAddress)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;Clear Success&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取得 address.json 的資料</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/GetAllAddress&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AllAddress</span>():</span><br><span class="line">    <span class="keyword">return</span> LoadAllAddress()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://flask-caching.readthedocs.io/en/latest/">Flask-Caching</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>Caching</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 Flask-SQLAlchemy 連接 MSSQL 進行 CRUD</title>
    <url>/2023/07/07/PythonFlaskSQLAlchemy/</url>
    <content><![CDATA[<h1 id="安裝套件"><a class="header-anchor" href="#安裝套件"></a>安裝套件</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install flask-sqlalchemy</span><br><span class="line">pip install pymssql</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="建立-app-py-內容如下"><a class="header-anchor" href="#建立-app-py-內容如下"></a>建立 <a href="http://app.py">app.py</a> 內容如下</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,jsonify</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&quot;SQLALCHEMY_TRACK_MODIFICATIONS&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&quot;SQLALCHEMY_DATABASE_URI&quot;</span>: <span class="string">&quot;mssql+pymssql://[使用者帳號]:%s@[服務器IP]:[端口]/[資料庫名稱]?charset=utf8&quot;</span>% parse.quote(<span class="string">&#x27;[使用者密碼]&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_mapping(config)</span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立資料表對應類別</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddressMap</span>(db.Model):</span><br><span class="line">    <span class="comment"># 資料表名稱</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;AddressMap&#x27;</span></span><br><span class="line">    <span class="comment"># 唯一識別碼</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 地址</span></span><br><span class="line">    address = db.Column(db.String(<span class="number">200</span>, collation=<span class="string">&quot;Chinese_Taiwan_Stroke_CI_AS&quot;</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 郵區</span></span><br><span class="line">    <span class="built_in">zip</span> = db.Column(db.String(<span class="number">6</span>), unique=<span class="literal">False</span>, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, <span class="built_in">zip</span></span>):</span><br><span class="line">        self.address = address</span><br><span class="line">        self.<span class="built_in">zip</span> = <span class="built_in">zip</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serialize</span>(<span class="params">self</span>):</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           <span class="string">&#x27;Id&#x27;</span> : self.<span class="built_in">id</span>,</span><br><span class="line">           <span class="string">&#x27;Address&#x27;</span> : self.address,</span><br><span class="line">           <span class="string">&#x27;Zip&#x27;</span> : self.<span class="built_in">zip</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;AddressMap %r&gt;&#x27;</span> % self.address</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_table</span>():</span><br><span class="line">    db.create_all()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 建立資料</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Address/Create&#x27;</span> , methods = [<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Create</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    address = data[<span class="string">&#x27;Address&#x27;</span>]</span><br><span class="line">    <span class="built_in">zip</span> = data[<span class="string">&#x27;Zip&#x27;</span>]</span><br><span class="line">    addressMap = AddressMap(address=address, <span class="built_in">zip</span>=<span class="built_in">zip</span>)</span><br><span class="line">    db.session.add(addressMap)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Create Success&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取得資料</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Address/GetAll&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AllAddress</span>():</span><br><span class="line">    all_address = AddressMap.query.<span class="built_in">all</span>()</span><br><span class="line">    addressList = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.serialize(), all_address))</span><br><span class="line">    <span class="keyword">return</span> jsonify(result=addressList)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新資料</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Address/Update&#x27;</span> , methods = [<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Update</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    <span class="built_in">id</span> = data[<span class="string">&#x27;Id&#x27;</span>]</span><br><span class="line">    address = AddressMap.query.filter_by(<span class="built_in">id</span>=<span class="built_in">id</span>).first()</span><br><span class="line">    <span class="keyword">if</span> address:</span><br><span class="line">        address.verified = <span class="literal">True</span></span><br><span class="line">        address.address = data[<span class="string">&#x27;Address&#x27;</span>]</span><br><span class="line">        address.<span class="built_in">zip</span> = data[<span class="string">&#x27;Zip&#x27;</span>]</span><br><span class="line">        db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Update Success&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除資料</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Address/Delete&#x27;</span> , methods = [<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Delete</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    <span class="built_in">id</span> = data[<span class="string">&#x27;Id&#x27;</span>]</span><br><span class="line">    address = AddressMap.query.filter_by(<span class="built_in">id</span>=<span class="built_in">id</span>).first()</span><br><span class="line">    <span class="keyword">if</span> address:</span><br><span class="line">        db.session.delete(address)</span><br><span class="line">        db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Delete Success&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<!-- export FLASK_APP=app
flask shell
from app import db, AddressMap
db.create_all() -->
<h1 id="使用Curl呼叫API"><a class="header-anchor" href="#使用Curl呼叫API"></a>使用Curl呼叫API</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 建立資料</span></span><br><span class="line">curl --location <span class="string">&#x27;http://127.0.0.1:5000/Address/Create&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;Address&quot; : &quot;新竹市&quot;,</span></span><br><span class="line"><span class="string">    &quot;Zip&quot; : &quot;300&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取得資料</span></span><br><span class="line">curl --location <span class="string">&#x27;http://127.0.0.1:5000/Address/GetAll&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新資料</span></span><br><span class="line">curl --location <span class="string">&#x27;http://127.0.0.1:5000/Address/Update&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;Id&quot; : 1,</span></span><br><span class="line"><span class="string">    &quot;Address&quot; : &quot;新竹市&quot;,</span></span><br><span class="line"><span class="string">    &quot;Zip&quot; : &quot;999&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除資料</span></span><br><span class="line">curl --location <span class="string">&#x27;http://127.0.0.1:5000/Address/Delete&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;Id&quot; : 1</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://flask-sqlalchemy.palletsprojects.com/en/3.0.x/">Flask-SQLAlchemy</a></li>
</ol>
</div>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>MSSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>安裝 Whistle</title>
    <url>/2023/01/20/WhistleProxyInstall/</url>
    <content><![CDATA[<h1 id="使用-Node-安裝-Whistle"><a class="header-anchor" href="#使用-Node-安裝-Whistle"></a>使用 Node 安裝 Whistle</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i -g whistle</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="啟動-Whistle"><a class="header-anchor" href="#啟動-Whistle"></a>啟動 Whistle</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">w2 start</span><br></pre></td></tr></table></figure>
<h1 id="查看-Whistle-狀態"><a class="header-anchor" href="#查看-Whistle-狀態"></a>查看 Whistle 狀態</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">w2 status</span><br></pre></td></tr></table></figure>
<h1 id="停止-Whistle"><a class="header-anchor" href="#停止-Whistle"></a>停止 Whistle</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">w2 stop</span><br></pre></td></tr></table></figure>
<h1 id="設定-Whistle-為-Proxy-的-Server"><a class="header-anchor" href="#設定-Whistle-為-Proxy-的-Server"></a>設定 Whistle 為 Proxy 的 Server</h1>
<p><img src="Win10ProxySetting.png" alt="Win10ProxySetting"></p>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://www.npmjs.com/package/whistle">whistle npm</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Whistle</category>
      </categories>
      <tags>
        <tag>Whistle</tag>
      </tags>
  </entry>
  <entry>
    <title>Whistle 代理規則使用</title>
    <url>/2023/01/20/WhistleProxyRule/</url>
    <content><![CDATA[<h1 id="設定-Dns-代理"><a class="header-anchor" href="#設定-Dns-代理"></a>設定 Dns 代理</h1>
<ul>
<li>在 Rules 頁籤加入以下設定，設定 Domain 對應 Ip 位置  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">example.<span class="attribute">com</span> <span class="number">192.168.0.1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<span id="more"></span>
<h1 id="設定-Http-的-StatusCode-代理"><a class="header-anchor" href="#設定-Http-的-StatusCode-代理"></a>設定 Http 的 StatusCode 代理</h1>
<ul>
<li>在 Rules 頁籤加入以下設定，設定狀態碼  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">^https://example.com/User/<span class="attribute">Get</span> statusCode://200</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="設定-Http-的-Headers-代理"><a class="header-anchor" href="#設定-Http-的-Headers-代理"></a>設定 Http 的 Headers 代理</h1>
<ul>
<li>
<p>在 Values 頁籤加入以下設定，命名為 corsheaders</p>
  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Content-Type: application/json; charset=utf8</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Rules 頁籤加入以下設定，設定 Headers</p>
  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">^https://example.com/User/<span class="attribute">Get</span> resHeaders://&#123;corsheaders&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="設定-Http-的-Body-代理"><a class="header-anchor" href="#設定-Http-的-Body-代理"></a>設定 Http 的 Body 代理</h1>
<ul>
<li>
<p>在 Values 頁籤加入以下設定，命名為 User.json</p>
  <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;張三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Rules 頁籤加入以下設定，設定 Headers</p>
  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">^https://example.com/User/<span class="attribute">Get</span> resBody://&#123;User.json&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="設定網頁嵌入-Js-檔案"><a class="header-anchor" href="#設定網頁嵌入-Js-檔案"></a>設定網頁嵌入 Js 檔案</h1>
<ul>
<li>
<p>在 Values 頁籤加入以下設定，命名為 test.js</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Rules 頁籤加入以下設定，設定 Js 檔案</p>
  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">^https://example.com/index.<span class="attribute">html</span> jsAppend://&#123;test.js&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="設定-Socks-代理"><a class="header-anchor" href="#設定-Socks-代理"></a>設定 Socks 代理</h1>
<p>搭配<a href="/2023/05/07/LinuxSshTunnel/" title="使用 SSH 建立通道">SSH</a>動態端口轉發請求</p>
<ul>
<li>在 Rules 頁籤加入以下設定，設定 Domain 對應 Ip 位置  <figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">example.<span class="attribute">com</span> socks://127.0.0.1:8080</span><br></pre></td></tr></table></figure>
</li>
</ul>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://wproxy.org/whistle/">whistle</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Whistle</category>
      </categories>
      <tags>
        <tag>Whistle</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10 家用版安裝 Docker</title>
    <url>/2023/05/05/Win10HomeDocker/</url>
    <content><![CDATA[<div class="note danger"><p>請注意，下方 Docker 應用只支援以 Ｗindows 為基底的 Image</p>
</div>
<h1 id="使用-Scoop-安裝-Docker"><a class="header-anchor" href="#使用-Scoop-安裝-Docker"></a>使用 Scoop 安裝 Docker</h1>
<p>執行下方命令安裝</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">scoop install docker</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="調整安裝空間"><a class="header-anchor" href="#調整安裝空間"></a>調整安裝空間</h1>
<p>複製 Docker 資料至磁碟機 D ，節省磁碟機 C 的空間</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Copy-Item</span> <span class="string">&#x27;C:\ProgramData\docker&#x27;</span> <span class="literal">-Destination</span> <span class="string">&#x27;d:\\docker&#x27;</span></span><br></pre></td></tr></table></figure>
<p>建立 ‘C:\ProgramData\docker\config\daemon.json’</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;tcp://0.0.0.0:&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data-root&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d:\\docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;8.8.8.8&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<div class="note danger"><p>請注意，因 Win10 家用版本身不支援安裝下方功能，開啟後可能發生未知錯誤，僅供學習使用</p>
</div>
<h1 id="安裝-Hyper-V-功能"><a class="header-anchor" href="#安裝-Hyper-V-功能"></a>安裝 Hyper-V 功能</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 將批處理檔案所在的目錄設定為工作目錄</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尋找符合檔案名的所有檔案名，匯出文字檔</span></span><br><span class="line"><span class="built_in">dir</span> /b %SystemRoot%\servicing\Packages\*Hyper<span class="literal">-V</span>*.mum &gt;hyper<span class="literal">-v</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入套件</span></span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">&#x27;findstr /i . hyper-v.txt 2^&gt;nul&#x27;</span>) <span class="keyword">do</span> dism /online /norestart /<span class="built_in">add-package</span>:<span class="string">&quot;%SystemRoot%\servicing\Packages\%%i&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除文字檔</span></span><br><span class="line"><span class="built_in">del</span> hyper<span class="literal">-v</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安裝容器套件</span></span><br><span class="line">Dism /online /<span class="built_in">enable-feature</span> /featurename:Microsoft<span class="literal">-Hyper-V-All</span> /LimitAccess /ALL</span><br></pre></td></tr></table></figure>
<p>以上方代碼建立 .bat 執行文件，並使用管理者權限執行</p>
<h1 id="安裝容器功能"><a class="header-anchor" href="#安裝容器功能"></a>安裝容器功能</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 將批處理檔案所在的目錄設定為工作目錄</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尋找符合檔案名的所有檔案名，匯出文字檔</span></span><br><span class="line"><span class="built_in">dir</span> /b %SystemRoot%\servicing\Packages\*containers*.mum &gt;containers.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入套件</span></span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">&#x27;findstr /i . containers.txt 2^&gt;nul&#x27;</span>) <span class="keyword">do</span> dism /online /norestart /<span class="built_in">add-package</span>:<span class="string">&quot;%SystemRoot%\servicing\Packages\%%i&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除文字檔</span></span><br><span class="line"><span class="built_in">del</span> containers.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安裝容器套件</span></span><br><span class="line">Dism /online /<span class="built_in">enable-feature</span> /featurename:containers /LimitAccess /ALL</span><br></pre></td></tr></table></figure>
<p>以上方代碼建立 .bat 執行文件，並使用管理者權限執行</p>
<h1 id="執行-Docker"><a class="header-anchor" href="#執行-Docker"></a>執行 Docker</h1>
<p>執行下方命令註冊 Ｗindows 服務</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">dockerd <span class="literal">--register-service</span> ; <span class="built_in">Start-Service</span> docker ; <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://scoop.sh/#/apps?q=docker&amp;s=0&amp;d=1&amp;o=true">Scoop Docker</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/virtualization/windowscontainers/manage-containers/container-base-images">Windows Base Image</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Wsl2</category>
      </categories>
      <tags>
        <tag>Wsl2</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL2 移動至其它硬碟</title>
    <url>/2023/05/05/Wsl2Disk/</url>
    <content><![CDATA[<h1 id="列出已安裝的-Linux-發行版"><a class="header-anchor" href="#列出已安裝的-Linux-發行版"></a>列出已安裝的 Linux 發行版</h1>
<p>執行下方命令</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">-l</span> <span class="literal">-v</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="遷移-WSL2-至磁碟機-D"><a class="header-anchor" href="#遷移-WSL2-至磁碟機-D"></a>遷移 WSL2 至磁碟機 D</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 導出已安裝的 Linux 發行版壓縮檔</span></span><br><span class="line">wsl <span class="literal">--export</span> <span class="string">&quot;Ubuntu-22.04&quot;</span> d:\ubuntu.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 WSL</span></span><br><span class="line">wsl <span class="literal">--unregister</span> <span class="string">&quot;Ubuntu-22.04&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立解壓縮的目錄</span></span><br><span class="line">mkdir d:\Ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux 發行版壓縮檔解壓縮至新目錄後加入 WSL</span></span><br><span class="line">wsl <span class="literal">--import</span> <span class="string">&quot;Ubuntu-22.04&quot;</span> d:\ubuntu d:\ubuntu.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 Linux 發行版壓縮檔</span></span><br><span class="line"><span class="built_in">del</span> d:\ubuntu.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因重新建立 WSL 會以 root 為預設帳戶，需重新設定預設帳戶</span></span><br><span class="line">ubuntu2204.exe config <span class="literal">--default-user</span> ubuntu</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://learn.microsoft.com/zh-tw/windows/wsl/use-custom-distro">匯入任何要與 WSL 搭配使用的 Linux 發行版本</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Wsl2</category>
      </categories>
      <tags>
        <tag>Wsl2</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL2 開放 Docker 外部連線</title>
    <url>/2023/04/29/Wsl2Docker/</url>
    <content><![CDATA[<h1 id="開放外部連線至-Docker，有兩種方式可擇一設定"><a class="header-anchor" href="#開放外部連線至-Docker，有兩種方式可擇一設定"></a>開放外部連線至 Docker，有兩種方式可擇一設定</h1>
<h2 id="建立-daemon-json"><a class="header-anchor" href="#建立-daemon-json"></a>建立 daemon.json</h2>
<p>建立 ‘/etc/docker/daemon.json’</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>
<p>加入以下設定</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tcp://0.0.0.0:&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="設定-Docker-服務"><a class="header-anchor" href="#設定-Docker-服務"></a>設定 Docker 服務</h2>
<p>調整服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl edit docker.service</span><br></pre></td></tr></table></figure>
<p>服務指令結尾加入 -H tcp://127.0.0.1:2375</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375</span><br></pre></td></tr></table></figure>
<p>重啟服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker.service</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="確認-docker-連線-2375是否存在"><a class="header-anchor" href="#確認-docker-連線-2375是否存在"></a>確認 docker 連線 *:2375是否存在</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ss -peanut | grep :2375</span><br></pre></td></tr></table></figure>
<h1 id="使用-Chocolatey-安裝-Docker-CLI"><a class="header-anchor" href="#使用-Chocolatey-安裝-Docker-CLI"></a>使用 Chocolatey 安裝 Docker CLI</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">choco install docker<span class="literal">-cli</span></span><br></pre></td></tr></table></figure>
<h1 id="設定主機連線有兩種方式"><a class="header-anchor" href="#設定主機連線有兩種方式"></a>設定主機連線有兩種方式</h1>
<ol>
<li>設定環境變數 DOCKER_HOST</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">Environment</span>]::SetEnvironmentVariable(<span class="string">&#x27;DOCKER_HOST&#x27;</span>, <span class="string">&quot;tcp://<span class="variable">$</span>(<span class="variable">$wslip</span>):2375&quot;</span>, <span class="string">&#x27;User&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>設定 docker context</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 取得 WSL 的 IP 位置</span></span><br><span class="line"><span class="variable">$wslip</span> = wsl <span class="literal">--</span> ip <span class="literal">-o</span> <span class="literal">-4</span> <span class="literal">-json</span> addr list eth0 | <span class="built_in">ConvertFrom-Json</span> | %&#123; <span class="variable">$_</span>.addr_info.local &#125; ` | ?&#123; <span class="variable">$_</span> &#125;</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Setting Docker context &#x27;wsl&#x27; to host=tcp://<span class="variable">$</span>(<span class="variable">$wslip</span>):2375&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立 context</span></span><br><span class="line">docker context create wsl <span class="literal">--docker</span> <span class="string">&quot;host=tcp://<span class="variable">$</span>(<span class="variable">$wslip</span>):2375&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 context</span></span><br><span class="line">docker context update wsl <span class="literal">--docker</span> <span class="string">&quot;host=tcp://<span class="variable">$</span>(<span class="variable">$wslip</span>):2375&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 context</span></span><br><span class="line">docker context use wsl</span><br><span class="line">docker <span class="literal">--context</span> wsl <span class="built_in">ps</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 顯示目前設定的 context</span></span><br><span class="line">docker context <span class="built_in">ls</span> <span class="literal">--format</span>=<span class="string">&quot;&#123;&#123;json .&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="使用-Powershell-取得-WSL-的-IP-位置"><a class="header-anchor" href="#使用-Powershell-取得-WSL-的-IP-位置"></a>使用 Powershell 取得 WSL 的 IP 位置</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">--</span> ip <span class="literal">-o</span> <span class="literal">-4</span> <span class="literal">-json</span> addr list eth0 `</span><br><span class="line">| <span class="built_in">ConvertFrom-Json</span> `</span><br><span class="line">| %&#123; <span class="variable">$_</span>.addr_info.local &#125; `</span><br><span class="line">| ?&#123; <span class="variable">$_</span> &#125;</span><br></pre></td></tr></table></figure>
<h1 id="測試-Docker-命令"><a class="header-anchor" href="#測試-Docker-命令"></a>測試 Docker 命令</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">docker <span class="literal">-H</span> [<span class="type">YOUR_WSL_IP</span>] <span class="built_in">ps</span></span><br></pre></td></tr></table></figure>
<!-- sudo dockerd& -->
<!-- docker run --rm hello-world -->
<h1 id="登入-wsl-自動啟動-Docker"><a class="header-anchor" href="#登入-wsl-自動啟動-Docker"></a>登入 wsl 自動啟動 Docker</h1>
<p>修改/etc/profile</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/profile</span><br></pre></td></tr></table></figure>
<p>加入以下設定</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export DOCKER_HOST=&quot;tcp://127.0.0.1:2375&quot;</span><br><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>
<h1 id="無密碼-sudo-授權-不建議用在生產環境"><a class="header-anchor" href="#無密碼-sudo-授權-不建議用在生產環境"></a>無密碼 sudo 授權(不建議用在生產環境)</h1>
<p>修改/etc/sudoers</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/sudoers</span><br></pre></td></tr></table></figure>
<p>加入以下設定</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%ubuntu ALL=(ALL:ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://community.chocolatey.org/packages/docker-cli">Daemon CLI (dockerd)</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file">Chocolatey Docker CLI</a></li>
<li><a href="https://docs.docker.com/config/daemon/remote-access/">Configure remote access for Docker daemon</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Wsl2</category>
      </categories>
      <tags>
        <tag>Wsl2</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL2 設定 Docker In Docker</title>
    <url>/2024/01/01/Wsl2DockerInDocker/</url>
    <content><![CDATA[<h1 id="使用主機的-Docker-Socket"><a class="header-anchor" href="#使用主機的-Docker-Socket"></a>使用主機的 Docker Socket</h1>
<h2 id="建立-daemon-json"><a class="header-anchor" href="#建立-daemon-json"></a>建立 daemon.json</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>
<p>加入以下設定</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tcp://0.0.0.0:&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="執行命令時掛載-docker-sock"><a class="header-anchor" href="#執行命令時掛載-docker-sock"></a>執行命令時掛載 docker.sock</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -v /var/run/docker.sock:/var/run/docker.sock -ti [Docker 映像檔]</span><br></pre></td></tr></table></figure>
<h2 id="透過-Curl-執行-Docker-Socket-建立-Containers"><a class="header-anchor" href="#透過-Curl-執行-Docker-Socket-建立-Containers"></a>透過 Curl 執行 Docker Socket 建立 Containers</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -XPOST --unix-socket /var/run/docker.sock -d <span class="string">&#x27;&#123;&quot;Image&quot;:&quot;[Docker 映像檔]&quot;&#125;&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> http://localhost/containers/create</span><br></pre></td></tr></table></figure>
<h2 id="透過-Curl-執行-Docker-Socket-啟動-Containers"><a class="header-anchor" href="#透過-Curl-執行-Docker-Socket-啟動-Containers"></a>透過 Curl 執行 Docker Socket 啟動 Containers</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/[容器編號]/start</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="使用-docker-dind-映像"><a class="header-anchor" href="#使用-docker-dind-映像"></a>使用 docker:dind 映像</h1>
<p>可參考以下兩種方法運行 docker:dind 映像</p>
<h2 id="透過特權模式選項執行命令"><a class="header-anchor" href="#透過特權模式選項執行命令"></a>透過特權模式選項執行命令</h2>
<p>特權模式選項: --privileged</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p [本機連接Port]:2375 --privileged -e DOCKER_TLS_CERTDIR=<span class="string">&quot;&quot;</span> --name privileged-docker -d docker:dind</span><br></pre></td></tr></table></figure>
<h2 id="透過-Nestybox-Sysbox-運行時選項執行命令"><a class="header-anchor" href="#透過-Nestybox-Sysbox-運行時選項執行命令"></a>透過 Nestybox Sysbox 運行時選項執行命令</h2>
<p>安裝 <a href="https://github.com/nestybox/sysbox?tab=readme-ov-file#installation">Nestybox Sysbox</a> 後，不需要特權模式，即可執行</p>
<p>運行時選項: --runtime=sysbox-runc</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p [本機連接Port]:2375 -e DOCKER_TLS_CERTDIR=<span class="string">&quot;&quot;</span> --runtime=sysbox-runc --name sysbox-docker -d docker:dind</span><br></pre></td></tr></table></figure>
<h1 id="使用-Docker-CLI-透過-Docker-contexts-連線至遠端-Docker"><a class="header-anchor" href="#使用-Docker-CLI-透過-Docker-contexts-連線至遠端-Docker"></a>使用 Docker CLI 透過 Docker contexts 連線至遠端 Docker</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 建立 Docker contexts</span></span><br><span class="line">docker context create <span class="built_in">test</span> --docker <span class="string">&quot;host=tcp://127.0.0.1:[本機連接Port]&quot;</span></span><br><span class="line"><span class="comment"># 使用 Docker contexts</span></span><br><span class="line">docker context use <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://kodekloud.com/blog/run-docker-in-docker-container/">3 Best Ways to Run Docker in Docker Container</a></li>
<li><a href="https://docs.docker.com/engine/api/sdk/examples/">Examples using the Docker Engine SDKs and Docker API</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Wsl2</category>
      </categories>
      <tags>
        <tag>Wsl2</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL2 設定固定 IP</title>
    <url>/2023/04/29/Wsl2Network/</url>
    <content><![CDATA[<h1 id="設定-DNS"><a class="header-anchor" href="#設定-DNS"></a>設定 DNS</h1>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 刪除原始的 resolv.conf 設定</span></span><br><span class="line">sudo <span class="built_in">rm</span> /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立 resolv.conf 設定，加入自訂 DNS</span></span><br><span class="line">sudo bash -c <span class="string">&#x27;echo &quot;nameserver 192.168.50.1&quot; &gt; /etc/resolv.conf&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入 Google 的 DNS 加速</span></span><br><span class="line">sudo bash -c <span class="string">&#x27;echo &quot;nameserver 8.8.8.8&quot; &gt;&gt; /etc/resolv.conf&#x27;</span></span><br><span class="line">sudo bash -c <span class="string">&#x27;echo &quot;nameserver 8.8.4.4&quot; &gt;&gt; /etc/resolv.conf&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定 /etc/wsl.conf</span></span><br><span class="line">sudo bash -c <span class="string">&#x27;echo &quot;[network]&quot; &gt; /etc/wsl.conf&#x27;</span></span><br><span class="line">sudo bash -c <span class="string">&#x27;echo &quot;generateResolvConf = false&quot; &gt;&gt; /etc/wsl.conf&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 鎖定 resolv.conf 設定</span></span><br><span class="line">sudo chattr +i /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h1 id="使用-Powershell-設定-Ububtu-網卡"><a class="header-anchor" href="#使用-Powershell-設定-Ububtu-網卡"></a>使用 Powershell 設定 Ububtu 網卡</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 搜尋 eth0 網卡 IP 設定</span></span><br><span class="line"><span class="variable">$ipAddr</span> = wsl <span class="literal">-u</span> root /bin/bash <span class="literal">-c</span> <span class="string">&quot;ip addr show eth0 | grep &#x27;inet\b&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ipAddr</span> = <span class="variable">$ipAddr</span>.Trim().Split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 確認是否為自訂的網卡設定</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$ipAddr</span>.Contains(<span class="string">&quot;192.168.50.2&quot;</span>))&#123;</span><br><span class="line">  <span class="comment"># 移除 Ububtu 網卡設定</span></span><br><span class="line">  wsl <span class="literal">-u</span> root /bin/bash <span class="literal">-c</span> <span class="string">&quot;ip addr del <span class="variable">$ipAddr</span> dev eth0&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 加入自訂的網卡</span></span><br><span class="line">  wsl <span class="literal">-u</span> root /bin/bash <span class="literal">-c</span> <span class="string">&quot;ip addr add 192.168.50.2/24 broadcast 192.168.50.255 dev eth0&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 加入自訂的路由</span></span><br><span class="line">  wsl <span class="literal">-u</span> root /bin/bash <span class="literal">-c</span> <span class="string">&quot;ip route add 0.0.0.0/0 via 192.168.50.1 dev eth0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- sudo ip addr del $(ip addr show eth0 | grep 'inet\b' | awk '{print $2}' | head -n 1) dev eth0 -->
<!-- sudo ip addr add 192.168.50.2/24 broadcast 192.168.50.255 dev eth0 -->
<!-- sudo ip route add 0.0.0.0/0 via 192.168.50.1 dev eth0 -->
<h1 id="使用-Powershell-設定-vEthernet-WSL"><a class="header-anchor" href="#使用-Powershell-設定-vEthernet-WSL"></a>使用 Powershell 設定 vEthernet (WSL)</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 確認是否為自訂的 vEthernet (WSL) 設定</span></span><br><span class="line"><span class="keyword">if</span>(!(<span class="built_in">Get-NetAdapter</span> <span class="string">&#x27;vEthernet (WSL)&#x27;</span> | <span class="built_in">Get-NetIPAddress</span>).IPAddress.Contains(<span class="string">&#x27;192.168.50.1&#x27;</span>))&#123;</span><br><span class="line">  <span class="comment"># 移除 vEthernet (WSL)設定</span></span><br><span class="line">  <span class="built_in">Get-NetAdapter</span> <span class="string">&#x27;vEthernet (WSL)&#x27;</span> | <span class="built_in">Get-NetIPAddress</span> | <span class="built_in">Remove-NetIPAddress</span> <span class="literal">-Confirm</span>:<span class="variable">$False</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 加入自訂的 vEthernet (WSL)</span></span><br><span class="line">  <span class="built_in">New-NetIPAddress</span> <span class="literal">-IPAddress</span> <span class="number">192.168</span>.<span class="number">50.1</span> <span class="literal">-PrefixLength</span> <span class="number">24</span> <span class="literal">-InterfaceAlias</span> <span class="string">&#x27;vEthernet (WSL)&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 移除 WSLNat 設定</span></span><br><span class="line">  <span class="built_in">Get-NetNat</span> | ? Name <span class="operator">-Eq</span> WSLNat | <span class="built_in">Remove-NetNat</span> <span class="literal">-Confirm</span>:<span class="variable">$False</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 加入自訂的 WSLNat</span></span><br><span class="line">  <span class="built_in">New-NetNat</span> <span class="literal">-Name</span> WSLNat <span class="literal">-InternalIPInterfaceAddressPrefix</span> <span class="number">192.168</span>.<span class="number">50.0</span>/<span class="number">24</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note warning"><p>📜 參考資料</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/380779630">知乎-給 WSL2 設置靜態IP地址</a></li>
</ol>
</div>]]></content>
      <categories>
        <category>Wsl2</category>
      </categories>
      <tags>
        <tag>Wsl2</tag>
      </tags>
  </entry>
</search>
